<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’­å®¢ç”Ÿæˆå™¨ - ä»æ–°é—»ç”Ÿæˆæ’­å®¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
            resize: vertical;
            min-height: 300px;
            line-height: 1.6;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            display: none;
        }
        
        .result.show {
            display: block;
        }
        
        .result h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .result-item {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }
        
        .result-item strong {
            color: #667eea;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #fee;
            border: 2px solid #fcc;
            color: #c00;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .error.show {
            display: block;
        }
        
        .tip {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 14px;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ™ï¸ AI æ’­å®¢ç”Ÿæˆå™¨</h1>
            <p>ä»æ–°é—»æ–‡æœ¬ç›´æ¥ç”Ÿæˆä¸“ä¸šæ’­å®¢è„šæœ¬</p>
        </div>
        
        <div class="content">
            <div class="tip">
                ğŸ’¡ <strong>ä½¿ç”¨æç¤ºï¼š</strong>ç›´æ¥ç²˜è´´ä»»ä½•æ–°é—»æ–‡ç« æˆ–æ–‡æœ¬å†…å®¹åˆ°ä¸‹æ–¹æ–‡æœ¬æ¡†ï¼Œç³»ç»Ÿå°†åŸºäºçœŸå®å†…å®¹ç”Ÿæˆæ’­å®¢è„šæœ¬ï¼Œä¸ä¼šç¼–é€ äº‹å®ã€‚
            </div>
            
            <form id="podcastForm">
                <div class="form-group">
                    <label for="topic">æ’­å®¢ä¸»é¢˜ *</label>
                    <input type="text" id="topic" name="topic" placeholder="ä¾‹å¦‚ï¼šåŠ å¯†è´§å¸å¸‚åœºæ“çºµåˆ†æ" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="duration">ç›®æ ‡æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰*</label>
                        <input type="number" id="duration" name="duration" min="1" max="30" value="5" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="style">æ’­å®¢é£æ ¼ *</label>
                        <select id="style" name="style">
                            <optgroup label="ğŸ‡ºğŸ‡¸ è‹±æ–‡æ¨¡æ¿">
                                <option value="english_2_hosts">è‹±æ–‡ - åŒä¸»æŒäººå¯¹è¯</option>
                                <option value="english_3_experts">è‹±æ–‡ - ä¸‰äººä¸“å®¶è®ºå›</option>
                                <option value="english_4_panel" selected>è‹±æ–‡ - å››äººåœ†æ¡Œè®¨è®º</option>
                            </optgroup>
                            <optgroup label="ğŸ‡°ğŸ‡· éŸ©æ–‡æ¨¡æ¿">
                                <option value="korean_2_hosts">éŸ©æ–‡ - åŒä¸»æŒäººå¯¹è¯</option>
                                <option value="korean_3_experts">éŸ©æ–‡ - ä¸‰äººä¸“å®¶è®¨è®º</option>
                            </optgroup>
                            <optgroup label="ğŸ‡¨ğŸ‡³ ä¸­æ–‡æ¨¡æ¿">
                                <option value="chinese_2_hosts">ä¸­æ–‡ - åŒä¸»æŒäººå¯¹è¯</option>
                            </optgroup>
                            <optgroup label="ğŸ‡¯ğŸ‡µ æ—¥æ–‡æ¨¡æ¿">
                                <option value="japanese_4_panel">æ—¥æ–‡ - å››äººåœ†æ¡Œè®¨è®º</option>
                            </optgroup>
                            <optgroup label="ğŸŒ åŒè¯­æ¨¡æ¿">
                                <option value="english_korean_bilingual">è‹±éŸ©åŒè¯­ - è·¨æ–‡åŒ–è®¨è®º</option>
                            </optgroup>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tone">è¯­è°ƒé£æ ¼</label>
                        <select id="tone" name="tone">
                            <option value="professional">ä¸“ä¸šä¸¥è‚ƒ</option>
                            <option value="casual">è½»æ¾éšæ„</option>
                            <option value="educational">æ•™è‚²æ€§</option>
                            <option value="entertaining">å¨±ä¹æ€§</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="dialogue_style">å¯¹è¯é£æ ¼</label>
                        <select id="dialogue_style" name="dialogue_style">
                            <option value="conversation">éšæ„å¯¹è¯</option>
                            <option value="interview">é‡‡è®¿å¯¹è¯</option>
                            <option value="debate">è¾©è®ºè®¨è®º</option>
                            <option value="panel">ä¸“å®¶è®ºå›</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="source_content">æ–°é—»å†…å®¹ * ï¼ˆç›´æ¥ç²˜è´´ï¼Œæ— éœ€è½¬ä¹‰ï¼‰</label>
                    <textarea id="source_content" name="source_content" placeholder="åœ¨è¿™é‡Œç²˜è´´å®Œæ•´çš„æ–°é—»æ–‡ç« å†…å®¹...

ä¾‹å¦‚ï¼š
--- Article: æ ‡é¢˜ ---
Summary: æ‘˜è¦å†…å®¹...
Highlights: é‡ç‚¹å†…å®¹...

æ”¯æŒä»»ä½•æ ¼å¼çš„æ–‡æœ¬ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ã€‚" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="generate_audio" name="generate_audio">
                        åŒæ—¶ç”ŸæˆéŸ³é¢‘æ–‡ä»¶ï¼ˆéœ€è¦æ›´é•¿æ—¶é—´ï¼‰
                    </label>
                </div>
                
                <button type="submit" class="btn" id="submitBtn">ğŸ¬ å¼€å§‹ç”Ÿæˆæ’­å®¢</button>
            </form>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨ç”Ÿæˆæ’­å®¢è„šæœ¬ï¼Œè¯·ç¨å€™...</p>
                <p style="font-size: 14px; color: #666; margin-top: 10px;">è¿™å¯èƒ½éœ€è¦15-30ç§’</p>
            </div>
            
            <div class="error" id="error"></div>
            
            <div class="result" id="result">
                <h3>âœ… ç”ŸæˆæˆåŠŸï¼</h3>
                <div class="result-item">
                    <strong>æ ‡é¢˜ï¼š</strong><span id="result-title"></span>
                </div>
                <div class="result-item">
                    <strong>æè¿°ï¼š</strong><span id="result-description"></span>
                </div>
                <div class="result-item">
                    <strong>æ®µè½æ•°ï¼š</strong><span id="result-segments"></span>
                </div>
                <div class="result-item">
                    <strong>é¢„è®¡æ—¶é•¿ï¼š</strong><span id="result-duration"></span>
                </div>
                <div class="result-item">
                    <strong>è„šæœ¬æ–‡ä»¶ï¼š</strong><span id="result-script-file"></span>
                </div>
                <div class="result-item">
                    <strong>è„šæœ¬ GCS è·¯å¾„ï¼š</strong><span id="result-script-gcs"></span>
                </div>
                <div class="result-item">
                    <strong>è„šæœ¬ä¸‹è½½ï¼š</strong> <span id="result-script-download"></span>
                </div>
                <div class="result-item" id="audio-file-container" style="display: none;">
                    <strong>éŸ³é¢‘æ–‡ä»¶ï¼š</strong><span id="result-audio-file"></span>
                </div>
                <div class="result-item">
                    <strong>éŸ³é¢‘ä¸‹è½½ï¼š</strong> <span id="result-audio-download"></span>
                </div>
                <div class="result-item">
                    <strong>Tokenä½¿ç”¨ï¼š</strong><span id="result-tokens"></span>
                </div>
                <div class="result-item">
                    <strong>LLM æ¶ˆè€—ä¼°ç®— (å¯é…ç½®)ï¼š</strong>
                    <div style="margin-top:8px;">
                        <label style="font-weight:600">æ¯ 1,000,000 tokens ä»·æ ¼ (USD): </label>
                        <input id="token-price-per-million" type="number" step="0.01" value="1.00" style="width:120px; margin-left:8px;" />
                        <div style="margin-top:6px;">ä¼°ç®—: <span id="result-token-cost">-</span> USD</div>
                    </div>
                </div>
                <div class="result-item">
                    <strong>Google TTS æ¶ˆè´¹ä¼°ç®—ï¼š</strong>
                    <div style="margin-top:8px;">
                        <label style="font-weight:600">æ¯ 1,000,000 å­—ç¬¦ ä»·æ ¼ (USD): </label>
                        <input id="tts-price-per-million" type="number" step="0.01" value="30.00" style="width:120px; margin-left:8px;" />
                        <div style="margin-top:6px;">ä¼°ç®—: <span id="result-tts-cost">-</span> USD ï¼ˆåŸºäºè¿”å›çš„å­—ç¬¦æ•°æˆ–éŸ³é¢‘æ—¶é•¿ï¼‰</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const API_ENDPOINT = 'https://podcast-service-355131621961.us-central1.run.app/v4/generate';

        const form = document.getElementById('podcastForm');
        const loading = document.getElementById('loading');
        const result = document.getElementById('result');
        const error = document.getElementById('error');
        const submitBtn = document.getElementById('submitBtn');
    const resultScriptGcs = document.getElementById('result-script-gcs');
    const resultScriptDownload = document.getElementById('result-script-download');
    const resultAudioDownload = document.getElementById('result-audio-download');
    const tokenPriceInput = document.getElementById('token-price-per-million');
    const resultTokenCost = document.getElementById('result-token-cost');
    const ttsPriceInput = document.getElementById('tts-price-per-million');
    const resultTtsCost = document.getElementById('result-tts-cost');

    // ç¼“å­˜æœ€è¿‘ä¸€æ¬¡ç»Ÿè®¡å€¼ï¼Œä¾¿äºä»·æ ¼å˜æ›´æ—¶å³æ—¶é‡ç®—
    let lastTotalTokens = 0;
    let lastTtsChars = 0;

    function updateTokenCost() {
        try {
            const pricePerMillion = parseFloat(tokenPriceInput.value) || 0;
            if (lastTotalTokens > 0 && pricePerMillion >= 0) {
                const cost = (lastTotalTokens / 1000000) * pricePerMillion;
                resultTokenCost.textContent = cost.toFixed(4);
            }
        } catch (_) { /* noop */ }
    }

    function updateTtsCost() {
        try {
            const pricePerMillion = parseFloat(ttsPriceInput.value) || 0;
            if (lastTtsChars > 0 && pricePerMillion >= 0) {
                const ttsCost = (lastTtsChars / 1000000) * pricePerMillion;
                resultTtsCost.textContent = `$${ttsCost.toFixed(4)} (â‰ˆ ${lastTtsChars} å­—ç¬¦)`;
            }
        } catch (_) { /* noop */ }
    }

    tokenPriceInput.addEventListener('input', updateTokenCost);
    ttsPriceInput.addEventListener('input', updateTtsCost);
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // é‡ç½®çŠ¶æ€
            loading.classList.add('show');
            result.classList.remove('show');
            error.classList.remove('show');
            submitBtn.disabled = true;
            
            // æ”¶é›†è¡¨å•æ•°æ®
            const formData = {
                topic: document.getElementById('topic').value,
                duration_minutes: parseInt(document.getElementById('duration').value),
                style_name: document.getElementById('style').value,
                tone: document.getElementById('tone').value,
                dialogue_style: document.getElementById('dialogue_style').value,
                source_content: document.getElementById('source_content').value,
                generate_audio: document.getElementById('generate_audio').checked
            };
            
            try {
                // å‘é€è¯·æ±‚
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // ğŸ” è¯¦ç»†çš„è°ƒè¯•è¾“å‡º
                console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                console.log('ğŸ“‹ API å“åº”è¯¦æƒ…');
                console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                console.log('å®Œæ•´å“åº”:', data);
                if (data.script_file_signed_url) {
                    console.log('âœ… è„šæœ¬ Signed URL (24h æœ‰æ•ˆ):');
                    console.log(data.script_file_signed_url);
                } else {
                    console.warn('âš ï¸ è„šæœ¬ Signed URL: æœªç”Ÿæˆ');
                }
                if (data.audio_file_signed_url) {
                    console.log('âœ… éŸ³é¢‘ Signed URL (24h æœ‰æ•ˆ):');
                    console.log(data.audio_file_signed_url);
                } else {
                    console.warn('âš ï¸ éŸ³é¢‘ Signed URL: æœªç”Ÿæˆ');
                }
                console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                
                if (data.status === 'success') {
                    // æ˜¾ç¤ºç»“æœ
                    document.getElementById('result-title').textContent = data.script_preview.title;
                    document.getElementById('result-description').textContent = data.script_preview.description;
                    document.getElementById('result-segments').textContent = data.script_preview.num_segments;
                    document.getElementById('result-duration').textContent = `${data.script_preview.estimated_duration_seconds.toFixed(1)} ç§’ (çº¦ ${(data.script_preview.estimated_duration_seconds / 60).toFixed(1)} åˆ†é’Ÿ)`;
                    document.getElementById('result-script-file').textContent = data.script_file;

                    // æ˜¾ç¤ºåŸå§‹ GCS è·¯å¾„ï¼ˆå¦‚æœæ˜¯ gs:// åˆ™æ˜¾ç¤ºï¼‰
                    resultScriptGcs.textContent = data.script_file || '';

                    // æ„å»ºå¯ç‚¹å‡»ä¸‹è½½é“¾æ¥ï¼ˆä½¿ç”¨ signed URLï¼‰
                    function makeDownloadLink(signedUrl, filename) {
                        if (!signedUrl) return '-';
                        
                        const a = document.createElement('a');
                        a.href = signedUrl;
                        a.download = filename || true;
                        a.target = '_blank';
                        a.rel = 'noopener noreferrer';
                        a.textContent = filename || 'ä¸‹è½½';
                        a.style.cssText = 'color: #667eea; text-decoration: underline; cursor: pointer;';
                        return a;
                    }

                    // è„šæœ¬ä¸‹è½½ï¼ˆä»…ä½¿ç”¨ signed URLï¼‰
                    resultScriptDownload.innerHTML = '';
                    if (data.script_file_signed_url) {
                        const scriptLink = makeDownloadLink(data.script_file_signed_url, 'ä¸‹è½½è„šæœ¬ (JSON)');
                        resultScriptDownload.appendChild(scriptLink);
                        console.log('âœ… è„šæœ¬ Signed URL å·²ç”Ÿæˆ');
                    } else {
                        resultScriptDownload.textContent = 'âŒ ç­¾å URL æœªç”Ÿæˆï¼ˆæƒé™ä¸è¶³ï¼‰';
                        console.error('âŒ è„šæœ¬ç­¾å URL ä¸ºç©ºï¼Œè¯·æ£€æŸ¥ IAM æƒé™');
                    }

                    // éŸ³é¢‘æ–‡ä»¶ï¼ˆä»…ä½¿ç”¨ signed URLï¼‰
                    if (data.audio_file_signed_url) {
                        document.getElementById('audio-file-container').style.display = 'block';
                        document.getElementById('result-audio-file').textContent = data.audio_file || '(å·²ç”Ÿæˆ)';
                        resultAudioDownload.innerHTML = '';
                        const audioLink = makeDownloadLink(data.audio_file_signed_url, 'ä¸‹è½½éŸ³é¢‘ (MP3)');
                        resultAudioDownload.appendChild(audioLink);
                        console.log('âœ… éŸ³é¢‘ Signed URL å·²ç”Ÿæˆ');
                    } else {
                        document.getElementById('audio-file-container').style.display = 'none';
                        resultAudioDownload.textContent = '-';
                    }

                    // Tokenç»Ÿè®¡
                    const tokenInfo = data.token_usage ?
                        `æ€»è®¡: ${data.token_usage.total_tokens || 'N/A'} (æç¤º: ${data.token_usage.prompt_tokens || 'N/A'}, å®Œæˆ: ${data.token_usage.completion_tokens || 'N/A'})` :
                        'ä¸å¯ç”¨';
                    document.getElementById('result-tokens').textContent = tokenInfo;

                    // è®¡ç®—å¹¶æ˜¾ç¤º LLM è´¹ç”¨ä¼°ç®—ï¼ˆæŒ‰ç™¾ä¸‡ tokens å®šä»·ï¼‰
                    try {
                        const pricePerMillion = parseFloat(tokenPriceInput.value) || 0;
                        const totalTokens = data.token_usage && data.token_usage.total_tokens ? Number(data.token_usage.total_tokens) : 0;
                        lastTotalTokens = totalTokens;
                        const cost = (totalTokens > 0) ? ((totalTokens / 1000000) * pricePerMillion) : 0;
                        resultTokenCost.textContent = totalTokens > 0 ? cost.toFixed(4) : '-';
                    } catch (e) {
                        resultTokenCost.textContent = '-';
                    }

                    // è®¡ç®—å¹¶æ˜¾ç¤º Google TTS è´¹ç”¨ä¼°ç®—
                    try {
                        const pricePerMillion = parseFloat(ttsPriceInput.value) || 0;
                        let chars = 0;
                        if (data.tts_character_count) {
                            chars = Number(data.tts_character_count);
                        } else if (data.script_preview && data.script_preview.estimated_duration_seconds) {
                            // ä¼°ç®—å­—ç¬¦æ•°ï¼šæ¯ç§’å¹³å‡çº¦ 15 ä¸ªå­—ç¬¦ï¼ˆä¿å®ˆä¼°è®¡ï¼‰
                            chars = Math.round(Number(data.script_preview.estimated_duration_seconds) * 15);
                        }
                        lastTtsChars = chars;
                        const ttsCost = chars > 0 ? (chars / 1000000) * pricePerMillion : 0;
                        resultTtsCost.textContent = chars > 0 ? `$${ttsCost.toFixed(4)} (â‰ˆ ${chars} å­—ç¬¦)` : '-';
                    } catch (e) {
                        resultTtsCost.textContent = '-';
                    }

                    result.classList.add('show');
                } else {
                    throw new Error(data.message || 'ç”Ÿæˆå¤±è´¥');
                }
                
            } catch (err) {
                error.textContent = `âŒ é”™è¯¯: ${err.message}`;
                error.classList.add('show');
            } finally {
                loading.classList.remove('show');
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
